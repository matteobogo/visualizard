<!DOCTYPE html>
<canvas></canvas>
<script src='../public/js/d3.v4.min.js'></script>
<script src='../public/js/d3-hsv.v0.1.min.js'></script>
<script src='../services/HeatMaps.js'></script>
<script>

    const data = buildHeatMapOrderByMachineId(
        'autogen',
        '2011-02-01T00:15:00.000Z',
        '2011-03-01T10:55:00.000Z',
        "mean_cpu_usage_rate"
    );

    console.log('aa');

    const width = data.width;
    const height = data.height;
    const max = data.max;
    const min = data.min;

    let i0 = d3.interpolateHsvLong(d3.hsv(255, 255, 255), d3.hsv(255, 255, 255)),
        i1 = d3.interpolateHsvLong(d3.hsv(60, 1, 0.90), d3.hsv(0, 0, 0.95)),
        interpolateTerrain = function(t) { return t < 0.5 ? i0(t * 2) : i1((t - 0.5) * 2); },
        color = d3.scaleSequential(interpolateTerrain).domain([min, max]);

    let canvas = d3.select("canvas")
        .attr("width", width)
        .attr("height", height);

    let context = canvas.node().getContext("2d");

    //create a new blank ImageData object with the specified dimensions
    //all pixels in the new object are transparent black
    let image = context.createImageData(width, height);

    for (let i = 0, l = 0; i < data.samples.length; ++i) {

        let points = data.samples[i].points;

        for (let j = 0; j < points.length; ++j, l+=4) {

            let c = d3.rgb(color(points[j]));

            //Uint8ClampedArray 8-bit unsigned integers
            //one-dimensional array containing the data in the RGBA order with integers between 0 and 255
            //RGBA (Red Green Blue Alpha) an RGB model with extra info
            image.data[l + 0] = c.r;
            image.data[l + 1] = c.g;
            image.data[l + 2] = c.b;
            image.data[l + 3] = 255;
        }
    }

    context.putImageData(image, 0, 0);

</script>